<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Personality Assessment</title>
  <!-- Chart.js for radar plots -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.45;
      margin: 0 auto;
      padding: 20px;
      max-width: 900px;
    }
    h1 {
      text-align: center;
      margin-top: 0;
    }
    #instructions {
      margin-bottom: 20px;
    }
    #question-container {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #f9f9f9;
    }
    .question-text {
      font-size: 1.1em;
      margin-bottom: 10px;
    }
    .options {
      margin-bottom: 15px;
    }
    .options label {
      margin-right: 15px;
    }
    #progress-bar {
      position: relative;
      height: 10px;
      background: #e0e0e0;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    #progress-inner {
      height: 100%;
      width: 0;
      background: #4caf50;
      border-radius: 5px;
      transition: width 0.3s ease;
    }
    #navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    #navigation-buttons button {
      padding: 10px 20px;
      font-size: 1em;
    }
    #result-container {
      display: none;
      margin-top: 30px;
    }
    #results-text {
      margin-top: 20px;
    }
    @media (max-width: 600px) {
      .options label {
        display: block;
        margin-bottom: 5px;
      }
    }
  </style>
</head>
<body>
  <h1>Advanced Personality Assessment</h1>
  <div id="instructions">
    <p>
      Answer the following questions as honestly as possible. Each statement applies
      to a particular context (work, relationships or leisure). Use the 1–7 scale
      where 1 means you strongly disagree and 7 means you strongly agree. There is
      no time limit. Your responses will inform your scores across several
      personality dimensions.
    </p>
  </div>
  <div id="progress-bar"><div id="progress-inner"></div></div>
  <div id="question-container"></div>
  <div id="navigation-buttons">
    <button id="prev" disabled>Previous</button>
    <button id="next">Next</button>
  </div>
  <div id="result-container">
    <h2>Your Results</h2>
    <canvas id="radarChart" width="400" height="300"></canvas>
    <div id="results-text"></div>
  </div>
  <script>
    // Define the eight dimensions used in this assessment
    const dimensions = [
      'Social Connectivity',
      'Cognitive Exploration',
      'Emotional Regulation',
      'Agreeableness/Empathy',
      'Conscientiousness',
      'Integrity/Honesty',
      'Adaptability/Flexibility',
      'Creativity/Ingenuity'
    ];

    // Define three contexts for situational variation
    const contexts = ['work', 'relationships', 'leisure'];

    // Base statements for each dimension. Five statements per dimension.
    const baseStatements = {
      'Social Connectivity': [
        'I enjoy initiating conversations with new people.',
        'I feel energized by social interactions.',
        'I prefer collaborative tasks over solitary work.',
        'I find it easy to network with others.',
        'I thrive in group activities.'
      ],
      'Cognitive Exploration': [
        'I am curious about new ideas and concepts.',
        'I enjoy learning new skills.',
        'I seek intellectual challenges.',
        'I appreciate diverse perspectives.',
        'I like exploring unconventional solutions.'
      ],
      'Emotional Regulation': [
        'I stay calm under pressure.',
        'I manage stress effectively.',
        'I recover quickly from setbacks.',
        'I maintain emotional balance.',
        'I handle criticism without becoming defensive.'
      ],
      'Agreeableness/Empathy': [
        'I empathize with others\' feelings.',
        'I avoid conflict and value harmony.',
        'I am considerate of others\' needs.',
        'I cooperate even when I disagree.',
        'I express gratitude and appreciation.'
      ],
      'Conscientiousness': [
        'I plan and organize tasks carefully.',
        'I pay attention to detail.',
        'I finish tasks on time.',
        'I persist through difficulties.',
        'I follow through on commitments.'
      ],
      'Integrity/Honesty': [
        'I adhere to my principles even under pressure.',
        'I am transparent about my intentions.',
        'I take responsibility for my actions.',
        'I resist temptation to cut corners.',
        'I value fairness and honesty.'
      ],
      'Adaptability/Flexibility': [
        'I adjust quickly to changes.',
        'I adapt my communication style to different people.',
        'I handle unexpected challenges calmly.',
        'I modify my plans when circumstances change.',
        'I am open to feedback and modify my behaviour accordingly.'
      ],
      'Creativity/Ingenuity': [
        'I generate novel ideas.',
        'I enjoy solving problems creatively.',
        'I experiment with new methods.',
        'I see connections others may miss.',
        'I think outside conventional boundaries.'
      ]
    };

    // Build the full list of questions: for each dimension, for each context, map the five base statements
    const questions = [];
    dimensions.forEach(dim => {
      contexts.forEach(ctx => {
        baseStatements[dim].forEach(stmt => {
          // Prepend the context to the statement for situational cues
          let prefix;
          switch (ctx) {
            case 'work':
              prefix = 'At work, ';
              break;
            case 'relationships':
              prefix = 'In my relationships, ';
              break;
            case 'leisure':
              prefix = 'During leisure time, ';
              break;
          }
          questions.push({
            text: prefix + stmt,
            dimension: dim,
            context: ctx
          });
        });
      });
    });

    // Shuffle questions to minimize order effects
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    shuffle(questions);

    // State variables
    let currentIndex = 0;
    const responses = [];
    const skipped = new Set();
    const dimensionResponses = {};
    dimensions.forEach(dim => {
      dimensionResponses[dim] = [];
    });

    // Render the current question
    function renderQuestion() {
      const container = document.getElementById('question-container');
      container.innerHTML = '';
      if (currentIndex >= questions.length) {
        showResults();
        return;
      }
      const q = questions[currentIndex];
      const p = document.createElement('p');
      p.className = 'question-text';
      p.textContent = `Question ${currentIndex + 1} of ${questions.length}: ` + q.text;
      container.appendChild(p);
      const optionsDiv = document.createElement('div');
      optionsDiv.className = 'options';
      for (let i = 1; i <= 7; i++) {
        const label = document.createElement('label');
        label.innerHTML = `<input type="radio" name="response" value="${i}"> ${i}`;
        optionsDiv.appendChild(label);
      }
      container.appendChild(optionsDiv);
      // Update progress bar
      const progressInner = document.getElementById('progress-inner');
      const percent = (currentIndex / questions.length) * 100;
      progressInner.style.width = percent + '%';
      // Disable previous button if at first question
      document.getElementById('prev').disabled = currentIndex === 0;
    }

    // Save response and handle dynamic skipping
    function saveResponse() {
      const selected = document.querySelector('input[name="response"]:checked');
      if (!selected) return false;
      const value = parseInt(selected.value, 10);
      const q = questions[currentIndex];
      responses[currentIndex] = value;
      dimensionResponses[q.dimension].push({ value, context: q.context });
      // Dynamic skipping logic: if two responses for a dimension are extreme (≤2 or ≥6), skip the remaining items for that dimension
      const dimData = dimensionResponses[q.dimension];
      if (dimData.length === 2) {
        const avg = (dimData[0].value + dimData[1].value) / 2;
        if (avg <= 2 || avg >= 6) {
          // skip remaining items for this dimension
          for (let i = currentIndex + 1; i < questions.length; i++) {
            if (questions[i].dimension === q.dimension) {
              skipped.add(i);
            }
          }
        }
      }
      return true;
    }

    // Event handlers for navigation buttons
    document.getElementById('next').addEventListener('click', () => {
      if (!saveResponse()) {
        alert('Please select a response before proceeding.');
        return;
      }
      // Move to next non-skipped question
      do {
        currentIndex++;
      } while (currentIndex < questions.length && skipped.has(currentIndex));
      if (currentIndex < questions.length) {
        renderQuestion();
      } else {
        showResults();
      }
    });
    document.getElementById('prev').addEventListener('click', () => {
      // Move to previous answered question
      if (currentIndex === 0) return;
      currentIndex--;
      // skip indices which were skipped
      while (currentIndex > 0 && skipped.has(currentIndex)) {
        currentIndex--;
      }
      renderQuestion();
    });

    function showResults() {
      document.getElementById('question-container').style.display = 'none';
      document.getElementById('navigation-buttons').style.display = 'none';
      document.getElementById('progress-bar').style.display = 'none';
      document.getElementById('result-container').style.display = 'block';
      // Compute average scores per dimension (0–100 scale)
      const dimScores = {};
      const contextScores = {};
      dimensions.forEach(dim => {
        const items = dimensionResponses[dim];
        if (items.length === 0) {
          dimScores[dim] = 0;
          return;
        }
        const sum = items.reduce((acc, item) => acc + item.value, 0);
        const avg = sum / items.length;
        // map 1–7 to 0–100
        dimScores[dim] = ((avg - 1) / 6) * 100;
        // per context
        items.forEach(item => {
          if (!contextScores[item.context]) contextScores[item.context] = {};
          if (!contextScores[item.context][dim]) contextScores[item.context][dim] = [];
          contextScores[item.context][dim].push(item.value);
        });
      });
      // Prepare data for radar chart
      const labels = dimensions;
      const dataValues = dimensions.map(dim => dimScores[dim]);
      const ctx = document.getElementById('radarChart').getContext('2d');
      new Chart(ctx, {
        type: 'radar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Your profile',
              data: dataValues,
              fill: true,
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              pointBackgroundColor: 'rgba(54, 162, 235, 1)'
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            r: {
              suggestedMin: 0,
              suggestedMax: 100,
              angleLines: { color: '#ccc' },
              grid: { color: '#e0e0e0' },
              pointLabels: { color: '#000', font: { size: 12 } },
              ticks: {
                callback: function(value) {
                  return value;
                }
              }
            }
          }
        }
      });
      // Compose result text with context-specific scores
      let resultHTML = '<h3>Dimension Scores (0–100)</h3><ul>';
      dimensions.forEach(dim => {
        resultHTML += `<li><strong>${dim}:</strong> ${dimScores[dim].toFixed(1)}</li>`;
      });
      resultHTML += '</ul>';
      // Context-specific interpretation
      resultHTML += '<h3>Context-Specific Patterns</h3>';
      for (const ctxName in contextScores) {
        resultHTML += `<h4>${ctxName.charAt(0).toUpperCase() + ctxName.slice(1)}</h4><ul>`;
        for (const dim in contextScores[ctxName]) {
          const values = contextScores[ctxName][dim];
          const avg = values.reduce((acc, v) => acc + v, 0) / values.length;
          const score = ((avg - 1) / 6) * 100;
          resultHTML += `<li>${dim}: ${score.toFixed(1)}</li>`;
        }
        resultHTML += '</ul>';
      }
      // Provide simple development recommendations based on highest and lowest scores
      const sortedDims = Object.entries(dimScores).sort((a, b) => b[1] - a[1]);
      const top = sortedDims[0];
      const bottom = sortedDims[sortedDims.length - 1];
      resultHTML += '<h3>Personalised Insights</h3>';
      resultHTML += `<p>Your strongest dimension appears to be <strong>${top[0]}</strong>. Consider leveraging this strength to enhance your work and relationships.</p>`;
      resultHTML += `<p>Your lowest dimension appears to be <strong>${bottom[0]}</strong>. Reflect on situations where this trait may have been challenged and explore strategies to develop it further.</p>`;
      resultHTML += '<p>Personality is dynamic; retake this assessment at different life stages to track changes.</p>';
      document.getElementById('results-text').innerHTML = resultHTML;
    }

    // Initialise first question on page load
    renderQuestion();
  </script>
</body>
</html>